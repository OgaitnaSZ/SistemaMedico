<div class="flex flex-col md:flex-row justify-between items-center p-5 gap-4">
    <h1 class="text-5xl font-medium">Listado de Pacientes</h1>

    <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
        <input type="text" placeholder="Buscar por nombre o DNI..." 
            class="w-full sm:w-64 px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500"
            [(ngModel)]="terminoBusqueda" (ngModelChange)="buscarPacientes()">
        <a class="bg-blue-600 text-white text-center px-4 py-2 rounded-lg hover:bg-blue-700 transition cursor-pointer" routerLink="/agregar-paciente">
        + Nuevo Paciente
        </a>
    </div>
</div>

<!-- Tabla de pacientes -->
<div class="p-4" *ngIf="pacientes.length>0 else noPacientes">
<div
  class="overflow-y-auto max-h-[85vh]"
  infiniteScroll
  [infiniteScrollDistance]="2"
  [infiniteScrollThrottle]="200"
  (scrolled)="cargarPacientes()"
  [scrollWindow]="false"
>
    <table class="min-w-full divide-y divide-gray-200 text-sm text-left">
      <thead class="bg-gray-100 text-gray-700 uppercase text-xs">
        <tr>
            <th class="px-6 py-3">#</th>
            <th class="px-6 py-3">Nombre</th>
            <th class="px-6 py-3">DNI</th>
            <th class="px-6 py-3">Género</th>
            <th class="px-6 py-3">Edad</th>
            <th class="px-6 py-3 text-center">Historia</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-100">
        <tr *ngFor="let paciente of pacientes ; let i = index" class="w-full table-fixed">
            <td class="px-6 py-4">{{ i + 1 }}</td>
            <td class="px-6 py-4 whitespace-nowrap">{{ paciente?.nombre }}, {{ paciente?.apellido }}</td>
            <td class="px-6 py-4">{{ paciente?.dni }}</td>
            <td class="px-6 py-4">{{ paciente?.genero }}</td>
            <td class="px-6 py-4">{{ paciente?.fechaNacimiento ? calcularEdad(paciente?.fechaNacimiento) : 'N/A' }}</td>
            <td class="px-6 py-4 flex justify-center gap-3 text-sm">
              <a [routerLink]="['/paciente', paciente.idPaciente]" class="text-blue-600 hover:underline"><span class="material-symbols-outlined">lab_profile</span></a>
            </td>
        </tr>
        <tr *ngIf="cargando">
          <td colspan="6" class="text-center py-3 text-blue-500">Cargando más pacientes...</td>
        </tr>
        <tr *ngIf="finalDeLista && pacientes.length > 0">
          <td colspan="6" class="text-center py-3 text-gray-400">No hay más pacientes.</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #noPacientes>
  <p class="text-center text-gray-500">
    Error al cargar pacientes.<br>{{ error }}
  </p>
</ng-template>
